<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Weatherfunctions • Weatherfunctions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weatherfunctions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Weatherfunctions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/Weatherfunctions.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Weatherfunctions</h1>
            
      

      <div class="d-none name"><code>Weatherfunctions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>The German Weather Service (DWD) supplies weather data in different
spatial and time resolution and from different types of weather
stations. This package aims to a) assist in retrieving this data in a
first step to a local copy of the data and b) in a second step to
prepare the data for simulations and other purposes. Thereby especially
the estimation of global radiation data from sunshine hours is supported
and interpolation for certain locations based on distance weighted use
of the nearest weather station is possible.</p>
<div class="section level3">
<h3 id="structure-of-dwd-ftp-service">Structure of DWD ftp service<a class="anchor" aria-label="anchor" href="#structure-of-dwd-ftp-service"></a>
</h3>
<div class="section level4">
<h4 id="daily-observations-of-weather-data">Daily observations of weather data<a class="anchor" aria-label="anchor" href="#daily-observations-of-weather-data"></a>
</h4>
<p>The daily observations of weather data from the stations are divided
into two sections, historical data which passed a quality control and
recent data, not yet full controlled and usually containing the data of
the actual and the data of the previous year. Their actuality is usually
one day back, so that the observations from the last day are available
on the next day. For convenience the link to these repositories and
their local copies as well as already transformed data is stored in
variable defined in the package. For the historical data the variable
“DWD_ftp_historical” is defined containing the link to <a href="ftp://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/kl/historical/" class="uri">ftp://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/kl/historical/</a>
and for the recent data the variable “DWD_ftp_recent” with the link to
<a href="ftp://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/kl/recent/" class="uri">ftp://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/kl/recent/</a>.
Also of interest are the directories with additional precipitation data
and solar radiation data which are available only for a limited number
of stations in Germany. There is also a directory with selected long
term observations from selected stations (timeseries_overview):</p>
<pre><code>├───kl
│   ├───historical
│   └───recent
├───more_precip
│   ├───historical
│   └───recent
├───solar
└───timeseries_overview</code></pre>
<p>In order to reduce the number of file transfers when using these data
it is convenient to make local copies of the DWD data. The package
assumes that there is a sub directory “LocalCopyDWD/” in your R project
and defines strings to the copies of recent and historical DWD data
C:_kage/R/data/R/Weatherfunctions/LocalCopyDWD/kl/historical.</p>
</div>
</div>
<div class="section level3">
<h3 id="structure-of-dwd-data-files">Structure of DWD data files<a class="anchor" aria-label="anchor" href="#structure-of-dwd-data-files"></a>
</h3>
<p>The data for the recent and historic observations are stored in ZIP
files, one for each station, which contain a number of files with meta
data and a data file (Example:
produkt_klima_tag_20211123_20230526_00164.txt) were the filename
consists of a string constant “produkt_klima_tag” two strings with the
date of the first and the last observation day in the file in the format
yyyymmdd and the Stations_id of the station as a 5 char string with
leading zeros.</p>
</div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<div class="section level4">
<h4 id="get-the-station-meta-data-getdwdcontent">Get the station meta data (getDWDContent)<a class="anchor" aria-label="anchor" href="#get-the-station-meta-data-getdwdcontent"></a>
</h4>
<p>The function “getDWDContent” reads the content of the DWD ftp server
and returns a data frame with the station meta data. The function is
used to get the station meta data for the historical and recent
observations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">DWDhistorical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDWDContent.html">getDWDContent</a></span><span class="op">(</span><span class="va">DWD_ftp_historical</span><span class="op">)</span></span>
<span><span class="va">DWDrecent</span>     <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDWDContent.html">getDWDContent</a></span><span class="op">(</span><span class="va">DWD_ftp_recent</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">DWDhistorical</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ stationlist:Classes 'data.table' and 'data.frame':    1249 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;   ..$ Stations_id  : chr [1:1249] "00001" "00003" "00011" "00044" ...</span></span>
<span><span class="co">#&gt;   ..$ von_datum    : chr [1:1249] "19370101" "18910101" "19800901" "19690101" ...</span></span>
<span><span class="co">#&gt;   ..$ bis_datum    : chr [1:1249] "19860630" "20110331" "20240930" "20240930" ...</span></span>
<span><span class="co">#&gt;   ..$ Stationshoehe: int [1:1249] 478 202 680 44 46 339 712 759 794 374 ...</span></span>
<span><span class="co">#&gt;   ..$ geoBreite    : num [1:1249] 47.8 50.8 48 52.9 53.7 ...</span></span>
<span><span class="co">#&gt;   ..$ geoLaenge    : num [1:1249] 8.85 6.09 8.52 8.24 10.2 ...</span></span>
<span><span class="co">#&gt;   ..$ Stationsname : chr [1:1249] "Aach" "Aachen" "Donaueschingen" "Großenkneten" ...</span></span>
<span><span class="co">#&gt;   ..$ Bundesland   : chr [1:1249] "Baden-Württemberg" "Nordrhein-Westfalen" "(Landeplatz)" "Niedersachsen" ...</span></span>
<span><span class="co">#&gt;   ..$ bisJahr      : num [1:1249] 1986 2011 2024 2024 2001 ...</span></span>
<span><span class="co">#&gt;   ..$ vonJahr      : num [1:1249] 1937 1891 1980 1969 1969 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;  $ filelist   : chr [1:1250] "KL_Tageswerte_Beschreibung_Stationen.txt" "tageswerte_KL_00001_19370101_19860630_hist.zip" "tageswerte_KL_00003_18910101_20110331_hist.zip" "tageswerte_KL_00011_19800901_20231231_hist.zip" ...</span></span>
<span><span class="co">#&gt;  $ ziplist    : chr [1:1249] "tageswerte_KL_00001_19370101_19860630_hist.zip" "tageswerte_KL_00003_18910101_20110331_hist.zip" "tageswerte_KL_00011_19800901_20231231_hist.zip" "tageswerte_KL_00044_19690101_20231231_hist.zip" ...</span></span>
<span><span class="co">#&gt;  $ zipID      : chr [1:1249] "00001" "00003" "00011" "00044" ...</span></span></code></pre></div>
<p>The function returns a list with the following elements:</p>
<ul>
<li>“stations” a data frame with the station meta data</li>
<li>“ziplist” a list of the ZIP files for the stations</li>
<li>“zipID” a list of the station IDs</li>
</ul>
</div>
<div class="section level4">
<h4 id="meta-data-for-additional-precipitation-stations">Meta data for additional precipitation stations<a class="anchor" aria-label="anchor" href="#meta-data-for-additional-precipitation-stations"></a>
</h4>
<p>For the additional data from stations measuring precipitation data
the function “getDWDContent” has to be called with the respective
parameters.</p>
<p>The DWD records for historical observations consists of data 5740
different historical stations (which changed over time) and for the
recent observations of values of 2100 stations.</p>
</div>
<div class="section level4">
<h4 id="retrieving-the-combined-recent-historic-information-getdwdstationlist">Retrieving the combined (recent &amp; historic) information
(getDWDStationList)<a class="anchor" aria-label="anchor" href="#retrieving-the-combined-recent-historic-information-getdwdstationlist"></a>
</h4>
<p>The function getDWDStationList retrieves the information (meta data)
for both, recent and historic directories. The function returns a
compiled data frame containing all station parameters (“stations”) as
well as the lists of the historical and recent weather station
information the function “getDWDContent” returns (see section
above).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DWD_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDWDStationList.html">getDWDStationList</a></span><span class="op">(</span>historical <span class="op">=</span> <span class="va">DWD_ftp_historical</span>, recent <span class="op">=</span> <span class="va">DWD_ftp_recent</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">DWD_content</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ stations  :'data.frame':  1258 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;   ..$ Stations_id  : chr [1:1258] "00001" "00003" "00011" "00044" ...</span></span>
<span><span class="co">#&gt;   ..$ von_datum    : chr [1:1258] "19370101" "18910101" "19800901" "19690101" ...</span></span>
<span><span class="co">#&gt;   ..$ bis_datum    : chr [1:1258] "19860630" "20110331" "20240930" "20240930" ...</span></span>
<span><span class="co">#&gt;   ..$ Stationshoehe: int [1:1258] 478 202 680 44 46 339 712 759 794 374 ...</span></span>
<span><span class="co">#&gt;   ..$ geoBreite    : num [1:1258] 47.8 50.8 48 52.9 53.7 ...</span></span>
<span><span class="co">#&gt;   ..$ geoLaenge    : num [1:1258] 8.85 6.09 8.52 8.24 10.2 ...</span></span>
<span><span class="co">#&gt;   ..$ Stationsname : chr [1:1258] "Aach" "Aachen" "Donaueschingen" "Großenkneten" ...</span></span>
<span><span class="co">#&gt;   ..$ Bundesland   : chr [1:1258] "Baden-Württemberg" "Nordrhein-Westfalen" "(Landeplatz)" "Niedersachsen" ...</span></span>
<span><span class="co">#&gt;   ..$ bisJahr      : num [1:1258] 1986 2011 2024 2024 2001 ...</span></span>
<span><span class="co">#&gt;   ..$ vonJahr      : num [1:1258] 1937 1891 1980 1969 1969 ...</span></span>
<span><span class="co">#&gt;  $ historical:List of 4</span></span>
<span><span class="co">#&gt;   ..$ stationlist:Classes 'data.table' and 'data.frame': 1249 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;   .. ..$ Stations_id  : chr [1:1249] "00001" "00003" "00011" "00044" ...</span></span>
<span><span class="co">#&gt;   .. ..$ von_datum    : chr [1:1249] "19370101" "18910101" "19800901" "19690101" ...</span></span>
<span><span class="co">#&gt;   .. ..$ bis_datum    : chr [1:1249] "19860630" "20110331" "20240930" "20240930" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Stationshoehe: int [1:1249] 478 202 680 44 46 339 712 759 794 374 ...</span></span>
<span><span class="co">#&gt;   .. ..$ geoBreite    : num [1:1249] 47.8 50.8 48 52.9 53.7 ...</span></span>
<span><span class="co">#&gt;   .. ..$ geoLaenge    : num [1:1249] 8.85 6.09 8.52 8.24 10.2 ...</span></span>
<span><span class="co">#&gt;   .. ..$ Stationsname : chr [1:1249] "Aach" "Aachen" "Donaueschingen" "Großenkneten" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Bundesland   : chr [1:1249] "Baden-Württemberg" "Nordrhein-Westfalen" "(Landeplatz)" "Niedersachsen" ...</span></span>
<span><span class="co">#&gt;   .. ..$ bisJahr      : num [1:1249] 1986 2011 2024 2024 2001 ...</span></span>
<span><span class="co">#&gt;   .. ..$ vonJahr      : num [1:1249] 1937 1891 1980 1969 1969 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;   ..$ filelist   : chr [1:1250] "KL_Tageswerte_Beschreibung_Stationen.txt" "tageswerte_KL_00001_19370101_19860630_hist.zip" "tageswerte_KL_00003_18910101_20110331_hist.zip" "tageswerte_KL_00011_19800901_20231231_hist.zip" ...</span></span>
<span><span class="co">#&gt;   ..$ ziplist    : chr [1:1249] "tageswerte_KL_00001_19370101_19860630_hist.zip" "tageswerte_KL_00003_18910101_20110331_hist.zip" "tageswerte_KL_00011_19800901_20231231_hist.zip" "tageswerte_KL_00044_19690101_20231231_hist.zip" ...</span></span>
<span><span class="co">#&gt;   ..$ zipID      : chr [1:1249] "00001" "00003" "00011" "00044" ...</span></span>
<span><span class="co">#&gt;  $ recent    :List of 4</span></span>
<span><span class="co">#&gt;   ..$ stationlist:Classes 'data.table' and 'data.frame': 576 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;   .. ..$ Stations_id  : chr [1:576] "00011" "00044" "00073" "00078" ...</span></span>
<span><span class="co">#&gt;   .. ..$ von_datum    : chr [1:576] "19800901" "19690101" "19590301" "19610101" ...</span></span>
<span><span class="co">#&gt;   .. ..$ bis_datum    : chr [1:576] "20240930" "20240930" "20240930" "20240930" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Stationshoehe: int [1:576] 680 44 374 64 305 304 50 0 739 296 ...</span></span>
<span><span class="co">#&gt;   .. ..$ geoBreite    : num [1:576] 48 52.9 48.6 52.5 50.8 ...</span></span>
<span><span class="co">#&gt;   .. ..$ geoLaenge    : num [1:576] 8.52 8.24 13.06 7.91 9.26 ...</span></span>
<span><span class="co">#&gt;   .. ..$ Stationsname : chr [1:576] "Donaueschingen" "Großenkneten" "Aldersbach-Kramersepp" "Alfhausen" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Bundesland   : chr [1:576] "(Landeplatz)" "Niedersachsen" "Bayern" "Niedersachsen" ...</span></span>
<span><span class="co">#&gt;   .. ..$ bisJahr      : num [1:576] 2024 2024 2024 2024 2024 ...</span></span>
<span><span class="co">#&gt;   .. ..$ vonJahr      : num [1:576] 1980 1969 1959 1961 1988 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;   ..$ filelist   : chr [1:577] "KL_Tageswerte_Beschreibung_Stationen.txt" "tageswerte_KL_00011_akt.zip" "tageswerte_KL_00044_akt.zip" "tageswerte_KL_00073_akt.zip" ...</span></span>
<span><span class="co">#&gt;   ..$ ziplist    : chr [1:576] "tageswerte_KL_00011_akt.zip" "tageswerte_KL_00044_akt.zip" "tageswerte_KL_00073_akt.zip" "tageswerte_KL_00078_akt.zip" ...</span></span>
<span><span class="co">#&gt;   ..$ zipID      : chr [1:576] "00011" "00044" "00073" "00078" ...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make-a-local-copy-of-dwd-observation-data-copy_dwd_zipfiles">Make a local copy of DWD observation data (Copy_DWD_ZipFiles)<a class="anchor" aria-label="anchor" href="#make-a-local-copy-of-dwd-observation-data-copy_dwd_zipfiles"></a>
</h4>
<p>For the file transfer the package holds the function
“Copy_DWD_ZipFiles” for downloading the files to the local directory,
which has to exist on the local machine. There are 500+ recent stations
available and 1000+ data for recent &amp; historic stations. So the
download takes some time.</p>
<p>For a total download of the recent and historical data the function
“Copy_DWD_ZipFiles” the function has to be called with the respective
parameters twice.</p>
</div>
</div>
<div class="section level3">
<h3 id="download-dwd-data">Download DWD data<a class="anchor" aria-label="anchor" href="#download-dwd-data"></a>
</h3>
<p>The package Weatherfunctions provides functions to download the data
from the DWD ftp server or its local copy.</p>
<div class="section level4">
<h4 id="data-for-a-single-weather-station-recent-or-historical-getsingledwdweather">Data for a single weather station recent or historical
(getsingleDWDWeather)<a class="anchor" aria-label="anchor" href="#data-for-a-single-weather-station-recent-or-historical-getsingledwdweather"></a>
</h4>
<p>The data from the DWD repository or its local copy can be downloaded
either from the historic or recent data repositories which can be the
DWD ftp service or its local copy using the function
getsingleDWDWeather.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Stations_id MESS_DATUM QN_3 FX FM QN_4 RSK RSKF  SDK SHK_TAG NM VPM PM TMK</span></span>
<span><span class="co">#&gt; 1          73   20230331   NA NA NA   10 5.3    4  1.6       0 NA 9.6 NA 8.1</span></span>
<span><span class="co">#&gt; 2          73   20230401   NA NA NA   10 3.6    4  0.5       0 NA 9.0 NA 8.9</span></span>
<span><span class="co">#&gt; 3          73   20230402   NA NA NA   10 5.3    4  0.0       0 NA 8.9 NA 6.9</span></span>
<span><span class="co">#&gt; 4          73   20230403   NA NA NA   10 0.0    0  2.2       0 NA 5.0 NA 3.4</span></span>
<span><span class="co">#&gt; 5          73   20230404   NA NA NA   10 0.0    0  5.3       0 NA 4.1 NA 2.1</span></span>
<span><span class="co">#&gt; 6          73   20230405   NA NA NA   10 0.0    0 12.6       0 NA 4.3 NA 1.8</span></span>
<span><span class="co">#&gt;   UPM  TXK  TNK  TGK eor MHoeheWind       Date</span></span>
<span><span class="co">#&gt; 1  89 14.8  3.2  1.9 eor         10 2023-03-31</span></span>
<span><span class="co">#&gt; 2  80 12.0  7.0  6.1 eor         10 2023-04-01</span></span>
<span><span class="co">#&gt; 3  88  9.8  3.2  2.4 eor         10 2023-04-02</span></span>
<span><span class="co">#&gt; 4  64  9.0 -0.8 -3.1 eor         10 2023-04-03</span></span>
<span><span class="co">#&gt; 5  60  7.4 -2.1 -5.4 eor         10 2023-04-04</span></span>
<span><span class="co">#&gt; 6  65  8.0 -3.7 -5.9 eor         10 2023-04-05</span></span></code></pre></div>
<p>In addition to the data from
produkt_klima_tag_YYYYMMDD_YYYYMMDD_nnnnn.txt, the measurement height of
wind speed was retrieved from the metadata file of the selected
weatherstations and a Date column is added in R format.</p>
<p>The downloaded data have column names according to the code of DWD,
for which in a first step also readable names are defined. in the data
frame df_names_DWD.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_names_DWD</span></span>
<span><span class="co">#&gt;   names_DWD           longNames_DWD</span></span>
<span><span class="co">#&gt; 1      QN_4       QUALITAETS_NIVEAU</span></span>
<span><span class="co">#&gt; 2       TMK          LUFTTEMPERATUR</span></span>
<span><span class="co">#&gt; 3        PM LUFTDRUCK_STATIONSHOEHE</span></span>
<span><span class="co">#&gt; 4       UPM             REL_FEUCHTE</span></span>
<span><span class="co">#&gt; 5        FM     WINDGESCHWINDIGKEIT</span></span>
<span><span class="co">#&gt; 6       TXK  LUFTTEMPERATUR_MAXIMUM</span></span>
<span><span class="co">#&gt; 7       TNK  LUFTTEMPERATUR_MINIMUM</span></span>
<span><span class="co">#&gt; 8       RSK      NIEDERSCHLAGSHOEHE</span></span>
<span><span class="co">#&gt; 9       SDK       SONNENSCHEINDAUER</span></span>
<span><span class="co">#&gt;                                       units_DWD           longNames_DWD_en</span></span>
<span><span class="co">#&gt; 1                                          code              QUALITY_LEVEL</span></span>
<span><span class="co">#&gt; 2                 Tagesmittel der Temperatur °C             AIRTEMPERATURE</span></span>
<span><span class="co">#&gt; 3                Tagesmittel des Luftdrucks hPa AIR_PRESSURE_STATIONHEIGHT</span></span>
<span><span class="co">#&gt; 4           Tagesmittel der Relativen Feuchte %               REL_HUMIDITY</span></span>
<span><span class="co">#&gt; 5           Tagesmittel Windgeschwindigkeit m/s                 WIND_SPEED</span></span>
<span><span class="co">#&gt; 6 Tagesmaximum der Lufttemperatur in 2m Höhe °C     AIRTEMPERATURE_MAXIMUM</span></span>
<span><span class="co">#&gt; 7 Tagesminimum der Lufttemperatur in 2m Höhe °C     AIRTEMPERATURE_MINIMUM</span></span>
<span><span class="co">#&gt; 8                 tägliche Niederschlagshöhe mm                   RAINFALL</span></span>
<span><span class="co">#&gt; 9                  tägliche Sonnenscheindauer h          SUNSHINE_DURATION</span></span>
<span><span class="co">#&gt;                                                                  ylabels</span></span>
<span><span class="co">#&gt; 1                                               QUALITAETS_NIVEAU [code]</span></span>
<span><span class="co">#&gt; 2                         LUFTTEMPERATUR [Tagesmittel der Temperatur °C]</span></span>
<span><span class="co">#&gt; 3               LUFTDRUCK_STATIONSHOEHE [Tagesmittel des Luftdrucks hPa]</span></span>
<span><span class="co">#&gt; 4                      REL_FEUCHTE [Tagesmittel der Relativen Feuchte %]</span></span>
<span><span class="co">#&gt; 5              WINDGESCHWINDIGKEIT [Tagesmittel Windgeschwindigkeit m/s]</span></span>
<span><span class="co">#&gt; 6 LUFTTEMPERATUR_MAXIMUM [Tagesmaximum der Lufttemperatur in 2m Höhe °C]</span></span>
<span><span class="co">#&gt; 7 LUFTTEMPERATUR_MINIMUM [Tagesminimum der Lufttemperatur in 2m Höhe °C]</span></span>
<span><span class="co">#&gt; 8                     NIEDERSCHLAGSHOEHE [tägliche Niederschlagshöhe mm]</span></span>
<span><span class="co">#&gt; 9                       SONNENSCHEINDAUER [tägliche Sonnenscheindauer h]</span></span>
<span><span class="co">#&gt;                                                  ylabels_en</span></span>
<span><span class="co">#&gt; 1                                      QUALITY_LEVEL [code]</span></span>
<span><span class="co">#&gt; 2                  AIRTEMPERATURE [Mean air temperature °C]</span></span>
<span><span class="co">#&gt; 3        AIR_PRESSURE_STATIONHEIGHT [Mean air pressure hPa]</span></span>
<span><span class="co">#&gt; 4                   REL_HUMIDITY [Mean relative humidity %]</span></span>
<span><span class="co">#&gt; 5                          WIND_SPEED [Mean wind speed m/s]</span></span>
<span><span class="co">#&gt; 6 AIRTEMPERATURE_MAXIMUM [Daily maximum air temperature °C]</span></span>
<span><span class="co">#&gt; 7 AIRTEMPERATURE_MINIMUM [Daily minimum air temperature °C]</span></span>
<span><span class="co">#&gt; 8                               RAINFALL [Rainfall rate mm]</span></span>
<span><span class="co">#&gt; 9                   SUNSHINE_DURATION [Sunshine duration h]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="download-combined-data-getcombineddwdweather">Download combined data (getcombinedDWDWeather)<a class="anchor" aria-label="anchor" href="#download-combined-data-getcombineddwdweather"></a>
</h4>
<p>For downloading the combination of historic and recent weather data
of a particular station the function “getcombinedDWDWeather” can be
used. It also adds station information to the returned data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_data</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">combined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getcombinedDWDWeather.html">getcombinedDWDWeather</a></span><span class="op">(</span>DWD_content <span class="op">=</span> <span class="va">DWD_content</span>, station <span class="op">=</span> <span class="va">selstation</span>,</span>
<span>                              recent_repository <span class="op">=</span> <span class="va">DWD_ftp_recent</span>, historical_repository <span class="op">=</span> <span class="va">DWD_ftp_historical</span>, local <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">combined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename.weather.html">rename.weather</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    23823 obs. of  25 variables:</span></span>
<span><span class="co">#&gt;  $ Stations_id            : int  73 73 73 73 73 73 73 73 73 73 ...</span></span>
<span><span class="co">#&gt;  $ MESS_DATUM             : int  19590301 19590302 19590303 19590304 19590305 19590306 19590307 19590308 19590309 19590310 ...</span></span>
<span><span class="co">#&gt;  $ QN_3                   : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ FX                     : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ WINDGESCHWINDIGKEIT    : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ QUALITAETS_NIVEAU      : int  5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;  $ NIEDERSCHLAGSHOEHE     : num  0 0 0 0 0 0.6 23.6 6.2 0 0 ...</span></span>
<span><span class="co">#&gt;  $ RSKF                   : int  0 0 0 0 0 1 1 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ SONNENSCHEINDAUER      : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ SHK_TAG                : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ NM                     : num  1.3 2.7 6 4.3 6 5.7 8 7.3 5.3 6.3 ...</span></span>
<span><span class="co">#&gt;  $ VPM                    : num  6.7 6.4 8.4 8.1 8.1 9.2 9.1 8.5 7.9 6.7 ...</span></span>
<span><span class="co">#&gt;  $ LUFTDRUCK_STATIONSHOEHE: logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR         : num  3.2 1 6.1 7.2 6.6 8.8 8.4 6.8 5.9 4.6 ...</span></span>
<span><span class="co">#&gt;  $ REL_FEUCHTE            : num  84 91 86 82 84 81 84 85 82 77 ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR_MAXIMUM : num  13 10.2 13 10.5 11.5 14 11.6 11 12.2 10.5 ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR_MINIMUM : num  -3 -2.8 -2 3.2 1.5 3.8 4 5.8 1 0 ...</span></span>
<span><span class="co">#&gt;  $ TGK                    : num  -2 -3.2 -3 3 1.5 4 3.5 4.5 1 0 ...</span></span>
<span><span class="co">#&gt;  $ eor                    : chr  "eor" "eor" "eor" "eor" ...</span></span>
<span><span class="co">#&gt;  $ MHoeheWind             : num  10 10 10 10 10 10 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;  $ Date                   : Date, format: "1959-03-01" "1959-03-02" ...</span></span>
<span><span class="co">#&gt;  $ Stationshoehe          : int  374 374 374 374 374 374 374 374 374 374 ...</span></span>
<span><span class="co">#&gt;  $ geoBreite              : num  48.6 48.6 48.6 48.6 48.6 ...</span></span>
<span><span class="co">#&gt;  $ geoLaenge              : num  13.1 13.1 13.1 13.1 13.1 ...</span></span>
<span><span class="co">#&gt;  $ Stationsname           : chr  "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" ...</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="add-radiation-data-getradweather">Add radiation data (getRadWeather)<a class="anchor" aria-label="anchor" href="#add-radiation-data-getradweather"></a>
</h3>
<p>The function getRadWeather uses the DWD-data in long name format and
adds several derived parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RadWeather</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">RadWeather</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getRadWeather.html">getRadWeather</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">RadWeather</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    23823 obs. of  36 variables:</span></span>
<span><span class="co">#&gt;  $ Stations_id            : int  73 73 73 73 73 73 73 73 73 73 ...</span></span>
<span><span class="co">#&gt;  $ MESS_DATUM             : int  19590301 19590302 19590303 19590304 19590305 19590306 19590307 19590308 19590309 19590310 ...</span></span>
<span><span class="co">#&gt;  $ QN_3                   : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ FX                     : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ WINDGESCHWINDIGKEIT    : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ QUALITAETS_NIVEAU      : int  5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;  $ NIEDERSCHLAGSHOEHE     : num  0 0 0 0 0 0.6 23.6 6.2 0 0 ...</span></span>
<span><span class="co">#&gt;  $ RSKF                   : int  0 0 0 0 0 1 1 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ SONNENSCHEINDAUER      : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ SHK_TAG                : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ NM                     : num  1.3 2.7 6 4.3 6 5.7 8 7.3 5.3 6.3 ...</span></span>
<span><span class="co">#&gt;  $ VPM                    : num  6.7 6.4 8.4 8.1 8.1 9.2 9.1 8.5 7.9 6.7 ...</span></span>
<span><span class="co">#&gt;  $ LUFTDRUCK_STATIONSHOEHE: logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR         : num  3.2 1 6.1 7.2 6.6 8.8 8.4 6.8 5.9 4.6 ...</span></span>
<span><span class="co">#&gt;  $ REL_FEUCHTE            : num  84 91 86 82 84 81 84 85 82 77 ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR_MAXIMUM : num  13 10.2 13 10.5 11.5 14 11.6 11 12.2 10.5 ...</span></span>
<span><span class="co">#&gt;  $ LUFTTEMPERATUR_MINIMUM : num  -3 -2.8 -2 3.2 1.5 3.8 4 5.8 1 0 ...</span></span>
<span><span class="co">#&gt;  $ TGK                    : num  -2 -3.2 -3 3 1.5 4 3.5 4.5 1 0 ...</span></span>
<span><span class="co">#&gt;  $ eor                    : chr  "eor" "eor" "eor" "eor" ...</span></span>
<span><span class="co">#&gt;  $ MHoeheWind             : num  10 10 10 10 10 10 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;  $ Date                   : Date, format: "1959-03-01" "1959-03-02" ...</span></span>
<span><span class="co">#&gt;  $ Stationshoehe          : int  374 374 374 374 374 374 374 374 374 374 ...</span></span>
<span><span class="co">#&gt;  $ geoBreite              : num  48.6 48.6 48.6 48.6 48.6 ...</span></span>
<span><span class="co">#&gt;  $ geoLaenge              : num  13.1 13.1 13.1 13.1 13.1 ...</span></span>
<span><span class="co">#&gt;  $ Stationsname           : chr  "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" "Aldersbach-Kramersepp" ...</span></span>
<span><span class="co">#&gt;  $ DOY                    : int  60 61 62 63 64 65 66 67 68 69 ...</span></span>
<span><span class="co">#&gt;  $ Dayl                   : num  10.7 10.8 10.9 10.9 11 ...</span></span>
<span><span class="co">#&gt;  $ Angot                  : num  19 19.3 19.5 19.8 20.1 ...</span></span>
<span><span class="co">#&gt;  $ RelSun                 : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ Monat                  : Factor w/ 12 levels "1","2","3","4",..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ EstSg_S0               : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ EstGlobRad             : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ExcelTime              : int  21610 21611 21612 21613 21614 21615 21616 21617 21618 21619 ...</span></span>
<span><span class="co">#&gt;  $ VP                     : num  6.45 5.97 8.08 8.31 8.17 ...</span></span>
<span><span class="co">#&gt;  $ Sat_def                : num  1.229 0.591 1.316 1.824 1.556 ...</span></span>
<span><span class="co">#&gt;  $ Rad_Int                : num  NA NA NA NA NA NA NA NA NA NA ...</span></span></code></pre></div>
<p>The additional columns are DOY: day of year, Dayl: daylength in
hours, Angot: maximum possible radiation outside atmosphere
[MJ.m-2.d-1], RelSun: the relative sunshine hours on that day, Monat:
the calendar month of the day, , EstGlobRad the estimated global
radiation of the day, ExcelTime: the day of year in Excel format, VP:
the average vapour pressure on the day [mBar], the saturation deficit of
the air and Ra_Int, the radiation intensity in [W.m-2]. The functions
uses other functions from the package and external functions to
calculate some of these parameters. <em>Calcsolar (dayofyear,
latitude)</em> calculates the daylength and the angot value. The
function <em>relrad(RelSun, Month)</em> calculates the relative
radiation compared to the angot values of that day of year. The function
is based on an empirical regression between the relative radiation the
relative sunshine duration for different months in Germany based on DWD
data.</p>
</div>
<div class="section level3">
<h3 id="saving-data-to-local-files-in-fst-format-updatedwddata_to_fst">Saving data to local files in fst-format (UpdateDWDData_to_fst)<a class="anchor" aria-label="anchor" href="#saving-data-to-local-files-in-fst-format-updatedwddata_to_fst"></a>
</h3>
<p>In order to save the downloaded data in a more compact and
pre-computed format the function UpdateDWDData_to_fst can be used.The
parameter isloadnew is used to load the data from the DWD ftp server, if
false the local zip-files will be used, if available. This again is a
time consuming process, as the data is read from the zip files and saved
in a fst file. For further analysis it is often sufficient to download
the historical data only to the fst file, as these data are updated only
once a year.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/UpdateDWDData_to_fst.html">UpdateDWDData_to_fst</a></span><span class="op">(</span>dataperiod <span class="op">=</span> <span class="st">"recent"</span>, startdate <span class="op">=</span> <span class="st">"1990-01-01"</span>, isloadnew <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>A saved file can be read using the function read.fst from the package
fst.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="st">"recent_weather_dat_1990.fst"</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Local_R_DWD</span>, <span class="va">fn</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">weather_recent</span> <span class="op">&lt;-</span> <span class="fu">read.fst</span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>The function UpdateDWDData_to_fst can also be used to update the
historical data. This is done by setting the parameter dataperiod to
“historical” and the startdate to the first date of the data to be
downloaded. This process is time consuming and should be done only once
a year.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/UpdateDWDData_to_fst.html">UpdateDWDData_to_fst</a></span><span class="op">(</span>dataperiod <span class="op">=</span> <span class="st">"historical"</span>, startdate <span class="op">=</span> <span class="st">"1990-01-01"</span>, isloadnew <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpolation-of-weather-data-for-a-selected-location">Interpolation of weather data for a selected location<a class="anchor" aria-label="anchor" href="#interpolation-of-weather-data-for-a-selected-location"></a>
</h3>
<p>The algorithm is basically based on the approach to select for every
day and for every weather parameter the values of the 3 nearest
observations and to interpolate between those values according to
inverse distance weigthing.</p>
<p>Additionally the rainfall data of the nearest weather station
including the additional rainfall stations are used.</p>
<p>The function InterpolateFromDWD is used to interpolate the weather
data for a selected location. The procedure is splitted in two parts,
first the interpolation of the historical data and second the
interpolation of the recent data, finally the data is combined in one
data frame.</p>
<p>The retrieval of the historical and - to a lesser extent - the recent
data is time consuming, as the data for each station has to be
downloaded as zip files and extracted. It is therefore more efficient to
pre download the data. The package supports two different approaches,
the first is to a fst file for further use. Here the the fst approach is
used.</p>
<div class="section level4">
<h4 id="retrieval-of-the-weather-data-for-interpolation">Retrieval of the weather data for interpolation<a class="anchor" aria-label="anchor" href="#retrieval-of-the-weather-data-for-interpolation"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># load historic weather data from local fst file ####</span></span>
<span><span class="co"># the filename is constructed from two strings for the actual path of the project</span></span>
<span><span class="co"># and a filename which are both pre defined.</span></span>
<span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="op">(</span><span class="va">Local_R_DWD</span>, <span class="va">fn_histDWD_data</span><span class="op">)</span></span>
<span><span class="va">weather_historic</span> <span class="op">&lt;-</span> <span class="fu">read.fst</span><span class="op">(</span>path <span class="op">=</span> <span class="va">fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select the columns that are in the core, i.e. essential data set and rename them</span></span>
<span><span class="va">weather_historic_core</span> <span class="op">&lt;-</span> <span class="va">weather_historic</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stations_id"</span>, <span class="st">"Date"</span>,<span class="va">longNames_DWD_core</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># update the local weather data for the recent period ######################</span></span>
<span><span class="co"># and store them in a fst file</span></span>
<span><span class="co"># this has to be done only once per day</span></span>
<span><span class="co"># the data is stored in a fst file</span></span>
<span><span class="co"># and takes up to 10-15 minutes</span></span>
<span></span>
<span><span class="va">ThisYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># take the data frame with meta data for recent stations to a separate variable</span></span>
<span><span class="va">RecentRainStationList</span> <span class="op">&lt;-</span> <span class="va">DWDRain_content</span><span class="op">$</span><span class="va">recent</span><span class="op">$</span><span class="va">stationlist</span></span>
<span></span>
<span><span class="va">UpdateRecentDWDdata</span> <span class="op">&lt;-</span> <span class="cn">F</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">UpdateRecentDWDdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">StartTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/UpdateDWDData_to_fst.html">UpdateDWDData_to_fst</a></span><span class="op">(</span>dataperiod <span class="op">=</span> <span class="st">"recent"</span>, </span>
<span>                       isloadnew <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                       DWD_content <span class="op">=</span> <span class="va">DWD_content</span>,</span>
<span>                       startdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ThisYear</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="st">"-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">EndTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Time for UpdateDWDData_to_fst:"</span>, <span class="va">EndTime</span> <span class="op">-</span> <span class="va">StartTime</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">fn_recentDWD_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"recent_weather_dat_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">)</span>,<span class="st">".fst"</span><span class="op">)</span></span>
<span><span class="va">weather_recent</span> <span class="op">&lt;-</span> <span class="fu">read.fst</span><span class="op">(</span>path <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="va">Local_R_DWD</span>, <span class="va">fn_recentDWD_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">weather_recent</span>  <span class="op">&lt;-</span> <span class="va">weather_recent</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stations_id"</span>,<span class="st">"Date"</span>,<span class="va">longNames_DWD_core</span><span class="op">)</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># set the location of the station  </span></span>
<span>  <span class="va">geoBreite</span> <span class="op">&lt;-</span> <span class="fl">52.7306</span></span>
<span>  <span class="va">geoLaenge</span> <span class="op">&lt;-</span> <span class="fl">10.6298</span></span>
<span>  <span class="va">Hoehe_m</span> <span class="op">&lt;-</span> <span class="fl">85</span></span>
<span>  </span>
<span>  <span class="co"># make location data frame  </span></span>
<span>  <span class="va">Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Latitude<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">geoBreite</span><span class="op">)</span>, Longitude<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">geoLaenge</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># make an sf object from Location data frame</span></span>
<span>  <span class="va">Location</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">Location</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">st_set_crs</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span></span></code></pre></div>
<p>The historic weather data contains the data for the years 1990 to the
previous year and consists of 7265855 records. The recent weather data
contains the data for the years 2023 to the current year and consists of
307941 records.</p>
</div>
<div class="section level4">
<h4 id="interpolation-of-the-historic-weather-data-for-the-location">Interpolation of the historic weather data for the location<a class="anchor" aria-label="anchor" href="#interpolation-of-the-historic-weather-data-for-the-location"></a>
</h4>
<p>In a next step the historic weather data is interpolated for the
location. If all gets ok then the data frame should have no NA
values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  </span>
<span><span class="co">### interpolate the historic weather data for the location  </span></span>
<span>  </span>
<span>  <span class="co"># retrieve the recent station list from the DWD content</span></span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="va">DWDhistorical</span><span class="op">$</span><span class="va">stationlist</span></span>
<span></span>
<span>  <span class="co"># make an sf object from stationlist data frame</span></span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">stationlist</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geoLaenge"</span>, <span class="st">"geoBreite"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">st_set_crs</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add the distance to the location to the stationlist data frame</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">st_distance</span><span class="op">(</span><span class="va">stationlist</span>, <span class="va">Location</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># minimum distance is 1 m because</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_m</span> <span class="op">/</span><span class="fl">1000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="co"># remove the geometry column</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">geometry</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stationlist</span><span class="op">)</span></span>
<span>  <span class="va">startdate</span> <span class="op">&lt;-</span> <span class="st">"1990-01-01"</span></span>
<span>  </span>
<span>  <span class="co"># select the nearest stations with rain data, for historical data it is necessary to select more than one station</span></span>
<span>  <span class="co"># because stations with rain data changed over time</span></span>
<span>  <span class="va">RainStations_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SelectStations.html">SelectStations</a></span> <span class="op">(</span>lat<span class="op">=</span><span class="va">geoBreite</span>,</span>
<span>                                          long<span class="op">=</span><span class="va">geoLaenge</span>,</span>
<span>                                          height_loc<span class="op">=</span><span class="va">Hoehe_m</span>, </span>
<span>                                          stationlist <span class="op">=</span> <span class="va">DWDRain_content</span><span class="op">$</span><span class="va">historical</span><span class="op">$</span><span class="va">stationlist</span>,</span>
<span>                                          <span class="co">#DWDRain_content$recent$stationlist,</span></span>
<span>                                          minstations<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                          max_stations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                          radius<span class="op">=</span><span class="fl">80000</span>,</span>
<span>                                          startdate<span class="op">=</span><span class="va">startdate</span>,</span>
<span>                                          max.Height.Distance_m<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># get the rain data for the selected stations</span></span>
<span>  </span>
<span>  <span class="va">df_Rain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetRainData_selection.html">GetRainData_selection</a></span><span class="op">(</span><span class="va">RainStations_selected</span>,</span>
<span>                                     <span class="va">DWDRain_content</span><span class="op">$</span><span class="va">historical</span>,</span>
<span>                                     repository<span class="op">=</span><span class="va">DWDRain_ftp_historical</span>,</span>
<span>                                     startdate<span class="op">=</span><span class="st">"1990-01-01"</span><span class="op">)</span> </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># add the distance to the rain station to the data frame</span></span>
<span></span>
<span>  <span class="va">df_Rain</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df_Rain</span>, <span class="va">RainStations_selected</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stations_id"</span>, <span class="st">"Distance_km"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"Stations_id"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># interpolate the weather data for the location</span></span>
<span>  <span class="va">IntPolDWDHistorical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InterpolateFromDWD.html">InterpolateFromDWD</a></span><span class="op">(</span>df_DWD_core <span class="op">=</span> <span class="va">weather_historic_core</span>, stationlist <span class="op">=</span> <span class="va">stationlist</span>, </span>
<span>                                          geoBreite <span class="op">=</span> <span class="va">geoBreite</span>, geoLaenge <span class="op">=</span> <span class="va">geoLaenge</span>, </span>
<span>                                max.Height.Distance_m<span class="op">=</span><span class="fl">100</span>, Hoehe_m <span class="op">=</span> <span class="va">Hoehe_m</span>, df_Rain <span class="op">=</span> <span class="va">df_Rain</span>, </span>
<span>                                startdate <span class="op">=</span> <span class="va">startdate</span><span class="op">)</span> </span>
<span>  <span class="va">IntPolDWDdataHistorical</span> <span class="op">&lt;-</span> <span class="va">IntPolDWDHistorical</span><span class="op">$</span><span class="va">DWDdata</span></span>
<span>  </span>
<span>  <span class="co"># remove the data for the current and previous year as they are in the recent data</span></span>
<span>  <span class="va">ThisYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">FirstDayOfYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ThisYear</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ExcelFirstDayofYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">FirstDayOfYear</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1899-12-30"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">IntPolDWDdataHistorical</span> <span class="op">&lt;-</span> <span class="va">IntPolDWDdataHistorical</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="va">ExcelFirstDayofYear</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add longitude and latitude to the data frame</span></span>
<span>  <span class="va">IntPolDWDdataHistorical</span><span class="op">$</span><span class="va">Longitude</span> <span class="op">&lt;-</span> <span class="va">geoLaenge</span></span>
<span>  <span class="va">IntPolDWDdataHistorical</span><span class="op">$</span><span class="va">Latitude</span> <span class="op">&lt;-</span> <span class="va">geoBreite</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">IntPolDWDdataHistorical</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Time            TMPM              Rain              LF        </span></span>
<span><span class="co">#&gt;  Min.   :32874   Min.   :-18.100   Min.   : 0.000   Min.   : 33.70  </span></span>
<span><span class="co">#&gt;  1st Qu.:35887   1st Qu.:  4.300   1st Qu.: 0.000   1st Qu.: 72.00  </span></span>
<span><span class="co">#&gt;  Median :38900   Median :  9.600   Median : 0.100   Median : 81.20  </span></span>
<span><span class="co">#&gt;  Mean   :38900   Mean   :  9.519   Mean   : 1.884   Mean   : 79.54  </span></span>
<span><span class="co">#&gt;  3rd Qu.:41913   3rd Qu.: 15.200   3rd Qu.: 1.900   3rd Qu.: 88.70  </span></span>
<span><span class="co">#&gt;  Max.   :44926   Max.   : 28.900   Max.   :56.200   Max.   :100.00  </span></span>
<span><span class="co">#&gt;        VP           Sat_def          Rad_Int         GlobRad     </span></span>
<span><span class="co">#&gt;  Min.   : 1.20   Min.   : 0.000   Min.   : 10.2   Min.   : 0.88  </span></span>
<span><span class="co">#&gt;  1st Qu.: 6.90   1st Qu.: 1.000   1st Qu.: 37.2   1st Qu.: 3.21  </span></span>
<span><span class="co">#&gt;  Median : 9.40   Median : 2.100   Median :100.3   Median : 8.67  </span></span>
<span><span class="co">#&gt;  Mean   :10.02   Mean   : 3.048   Mean   :119.4   Mean   :10.31  </span></span>
<span><span class="co">#&gt;  3rd Qu.:12.90   3rd Qu.: 4.200   3rd Qu.:189.7   3rd Qu.:16.39  </span></span>
<span><span class="co">#&gt;  Max.   :23.30   Max.   :25.200   Max.   :347.0   Max.   :29.98  </span></span>
<span><span class="co">#&gt;       Wind            TMPMN             TMPMX          Longitude    </span></span>
<span><span class="co">#&gt;  Min.   : 0.500   Min.   :-22.100   Min.   :-12.60   Min.   :10.63  </span></span>
<span><span class="co">#&gt;  1st Qu.: 2.000   1st Qu.:  0.800   1st Qu.:  7.30   1st Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Median : 2.700   Median :  5.400   Median : 14.10   Median :10.63  </span></span>
<span><span class="co">#&gt;  Mean   : 3.013   Mean   :  5.235   Mean   : 14.01   Mean   :10.63  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 3.800   3rd Qu.: 10.100   3rd Qu.: 20.70   3rd Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Max.   :12.100   Max.   : 21.100   Max.   : 39.20   Max.   :10.63  </span></span>
<span><span class="co">#&gt;     Latitude    </span></span>
<span><span class="co">#&gt;  Min.   :52.73  </span></span>
<span><span class="co">#&gt;  1st Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Median :52.73  </span></span>
<span><span class="co">#&gt;  Mean   :52.73  </span></span>
<span><span class="co">#&gt;  3rd Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Max.   :52.73</span></span>
<span>  </span>
<span>  <span class="va">usedstations</span> <span class="op">&lt;-</span> <span class="va">IntPolDWDHistorical</span><span class="op">$</span><span class="va">df.wf</span></span>
<span>  <span class="va">usedstations</span><span class="op">$</span><span class="va">Distance</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">usedstations</span><span class="op">$</span><span class="va">InvDist</span></span>
<span>  <span class="va">Diststations</span> <span class="op">&lt;-</span> <span class="va">usedstations</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Distance</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Diststations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   variable               Distance</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> LUFTTEMPERATUR            26.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> REL_FEUCHTE               26.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> WINDGESCHWINDIGKEIT       41.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> LUFTTEMPERATUR_MAXIMUM    26.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> LUFTTEMPERATUR_MINIMUM    26.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> NIEDERSCHLAGSHOEHE         6.43</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> SONNENSCHEINDAUER         35.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> MHoeheWind                25.7</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="interpolation-of-the-recent-weather-data-for-the-location">Interpolation of the recent weather data for the location<a class="anchor" aria-label="anchor" href="#interpolation-of-the-recent-weather-data-for-the-location"></a>
</h4>
<p>In a next step the recent weather data is interpolated for the
location. Here, the data for the most actual date(s) may be
incomplete.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  </span>
<span><span class="co"># recent data #######</span></span>
<span></span>
<span>  <span class="co">## retrieve the recent station list from the DWD content</span></span>
<span>  </span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="va">DWDrecent</span><span class="op">$</span><span class="va">stationlist</span></span>
<span></span>
<span>  <span class="co"># make an sf object from stationlist data frame</span></span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">stationlist</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geoLaenge"</span>, <span class="st">"geoBreite"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">st_set_crs</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add the distance to the location to the stationlist data frame</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">st_distance</span><span class="op">(</span><span class="va">stationlist</span>, <span class="va">Location</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># minimum distance is 1 m because</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">stationlist</span><span class="op">$</span><span class="va">Distance_m</span> <span class="op">/</span><span class="fl">1000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="co"># remove the geometry column</span></span>
<span>  <span class="va">stationlist</span><span class="op">$</span><span class="va">geometry</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">stationlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stationlist</span><span class="op">)</span></span>
<span>  <span class="va">startdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ThisYear</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="st">"-01-01"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># select the neart stations with rain data</span></span>
<span>  <span class="va">RainStation_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SelectStations.html">SelectStations</a></span> <span class="op">(</span>lat<span class="op">=</span><span class="va">geoBreite</span>,</span>
<span>                                          long<span class="op">=</span><span class="va">geoLaenge</span>,</span>
<span>                                          height_loc<span class="op">=</span><span class="va">Hoehe_m</span>, </span>
<span>                                          stationlist <span class="op">=</span> <span class="va">RecentRainStationList</span>,</span>
<span>                                          <span class="co">#DWDRain_content$recent$stationlist,</span></span>
<span>                                          minstations<span class="op">=</span><span class="fl">3</span>,</span>
<span>                                          max_stations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                          radius<span class="op">=</span><span class="fl">80000</span>,</span>
<span>                                          startdate<span class="op">=</span><span class="va">startdate</span>,</span>
<span>                                          max.Height.Distance_m<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># get the rain data for the selected stations</span></span>
<span>  </span>
<span>  <span class="va">df_Rain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetRainData_selection.html">GetRainData_selection</a></span><span class="op">(</span><span class="va">RainStations_selected</span>,</span>
<span>                                     <span class="va">DWDRain_content</span><span class="op">$</span><span class="va">recent</span>,</span>
<span>                                     repository<span class="op">=</span><span class="va">DWDRain_ftp_recent</span>,</span>
<span>                                     startdate<span class="op">=</span><span class="st">"2023-01-01"</span><span class="op">)</span> </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># add the distance to the rain station to the data frame</span></span>
<span></span>
<span>  <span class="va">df_Rain</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df_Rain</span>, <span class="va">RainStations_selected</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stations_id"</span>, <span class="st">"Distance_km"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"Stations_id"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="va">IntpolDWDrecent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InterpolateFromDWD.html">InterpolateFromDWD</a></span><span class="op">(</span>df_DWD_core <span class="op">=</span> <span class="va">weather_recent</span>, stationlist <span class="op">=</span> <span class="va">stationlist</span>, geoBreite <span class="op">=</span> <span class="va">geoBreite</span>, geoLaenge <span class="op">=</span> <span class="va">geoLaenge</span>, </span>
<span>                                max.Height.Distance_m<span class="op">=</span><span class="fl">100</span>, Hoehe_m <span class="op">=</span> <span class="va">Hoehe_m</span>, df_Rain <span class="op">=</span> <span class="va">df_Rain</span>, </span>
<span>                                startdate <span class="op">=</span> <span class="va">startdate</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">IntPolDWDdatarecent</span> <span class="op">&lt;-</span> <span class="va">IntpolDWDrecent</span><span class="op">$</span><span class="va">DWDdata</span></span>
<span> </span>
<span>  </span>
<span>  </span>
<span>  <span class="va">IntPolDWDdatarecent</span><span class="op">$</span><span class="va">Longitude</span> <span class="op">&lt;-</span> <span class="va">geoLaenge</span></span>
<span>  <span class="va">IntPolDWDdatarecent</span><span class="op">$</span><span class="va">Latitude</span> <span class="op">&lt;-</span> <span class="va">geoBreite</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">IntPolDWDdatarecent</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Time            TMPM             Rain              LF       </span></span>
<span><span class="co">#&gt;  Min.   :45016   Min.   :-7.100   Min.   : 0.000   Min.   :40.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:45153   1st Qu.: 7.625   1st Qu.: 0.000   1st Qu.:69.25  </span></span>
<span><span class="co">#&gt;  Median :45291   Median :13.850   Median : 0.000   Median :78.45  </span></span>
<span><span class="co">#&gt;  Mean   :45291   Mean   :12.602   Mean   : 2.749   Mean   :77.15  </span></span>
<span><span class="co">#&gt;  3rd Qu.:45428   3rd Qu.:17.600   3rd Qu.: 3.075   3rd Qu.:85.20  </span></span>
<span><span class="co">#&gt;  Max.   :45565   Max.   :24.900   Max.   :36.000   Max.   :99.00  </span></span>
<span><span class="co">#&gt;        VP            Sat_def          Rad_Int          GlobRad      </span></span>
<span><span class="co">#&gt;  Min.   : 2.800   Min.   : 0.100   Min.   : 10.20   Min.   : 0.880  </span></span>
<span><span class="co">#&gt;  1st Qu.: 8.425   1st Qu.: 1.700   1st Qu.: 63.55   1st Qu.: 5.492  </span></span>
<span><span class="co">#&gt;  Median :11.400   Median : 3.200   Median :152.90   Median :13.215  </span></span>
<span><span class="co">#&gt;  Mean   :11.723   Mean   : 3.903   Mean   :148.83   Mean   :12.859  </span></span>
<span><span class="co">#&gt;  3rd Qu.:15.000   3rd Qu.: 5.400   3rd Qu.:216.88   3rd Qu.:18.738  </span></span>
<span><span class="co">#&gt;  Max.   :23.300   Max.   :15.300   Max.   :343.50   Max.   :29.680  </span></span>
<span><span class="co">#&gt;       Wind           TMPMN             TMPMX         Longitude    </span></span>
<span><span class="co">#&gt;  Min.   :0.700   Min.   :-10.100   Min.   :-2.60   Min.   :10.63  </span></span>
<span><span class="co">#&gt;  1st Qu.:1.900   1st Qu.:  3.900   1st Qu.:11.20   1st Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Median :2.500   Median :  8.200   Median :18.90   Median :10.63  </span></span>
<span><span class="co">#&gt;  Mean   :2.733   Mean   :  7.614   Mean   :17.58   Mean   :10.63  </span></span>
<span><span class="co">#&gt;  3rd Qu.:3.500   3rd Qu.: 11.800   3rd Qu.:23.70   3rd Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Max.   :7.300   Max.   : 17.900   Max.   :33.90   Max.   :10.63  </span></span>
<span><span class="co">#&gt;     Latitude    </span></span>
<span><span class="co">#&gt;  Min.   :52.73  </span></span>
<span><span class="co">#&gt;  1st Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Median :52.73  </span></span>
<span><span class="co">#&gt;  Mean   :52.73  </span></span>
<span><span class="co">#&gt;  3rd Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Max.   :52.73</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="combine-the-historical-and-recent-data">Combine the historical and recent data<a class="anchor" aria-label="anchor" href="#combine-the-historical-and-recent-data"></a>
</h3>
<p>The data from the historical and recent data is combined in one data
frame.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  </span>
<span>  <span class="va">DWDdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">IntPolDWDdataHistorical</span>, <span class="va">IntPolDWDdatarecent</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DWDdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Time            TMPM              Rain              LF        </span></span>
<span><span class="co">#&gt;  Min.   :32874   Min.   :-18.100   Min.   : 0.000   Min.   : 33.70  </span></span>
<span><span class="co">#&gt;  1st Qu.:36025   1st Qu.:  4.400   1st Qu.: 0.000   1st Qu.: 71.90  </span></span>
<span><span class="co">#&gt;  Median :39175   Median :  9.700   Median : 0.100   Median : 81.00  </span></span>
<span><span class="co">#&gt;  Mean   :39179   Mean   :  9.654   Mean   : 1.921   Mean   : 79.43  </span></span>
<span><span class="co">#&gt;  3rd Qu.:42326   3rd Qu.: 15.300   3rd Qu.: 2.000   3rd Qu.: 88.60  </span></span>
<span><span class="co">#&gt;  Max.   :45565   Max.   : 28.900   Max.   :56.200   Max.   :100.00  </span></span>
<span><span class="co">#&gt;        VP           Sat_def          Rad_Int         GlobRad     </span></span>
<span><span class="co">#&gt;  Min.   : 1.20   Min.   : 0.000   Min.   : 10.2   Min.   : 0.88  </span></span>
<span><span class="co">#&gt;  1st Qu.: 6.90   1st Qu.: 1.000   1st Qu.: 37.7   1st Qu.: 3.25  </span></span>
<span><span class="co">#&gt;  Median : 9.50   Median : 2.200   Median :102.7   Median : 8.87  </span></span>
<span><span class="co">#&gt;  Mean   :10.09   Mean   : 3.085   Mean   :120.7   Mean   :10.42  </span></span>
<span><span class="co">#&gt;  3rd Qu.:13.00   3rd Qu.: 4.300   3rd Qu.:191.3   3rd Qu.:16.53  </span></span>
<span><span class="co">#&gt;  Max.   :23.30   Max.   :25.200   Max.   :347.0   Max.   :29.98  </span></span>
<span><span class="co">#&gt;       Wind          TMPMN             TMPMX          Longitude    </span></span>
<span><span class="co">#&gt;  Min.   : 0.5   Min.   :-22.100   Min.   :-12.60   Min.   :10.63  </span></span>
<span><span class="co">#&gt;  1st Qu.: 2.0   1st Qu.:  0.800   1st Qu.:  7.50   1st Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Median : 2.7   Median :  5.600   Median : 14.20   Median :10.63  </span></span>
<span><span class="co">#&gt;  Mean   : 3.0   Mean   :  5.339   Mean   : 14.17   Mean   :10.63  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 3.7   3rd Qu.: 10.300   3rd Qu.: 20.80   3rd Qu.:10.63  </span></span>
<span><span class="co">#&gt;  Max.   :12.1   Max.   : 21.100   Max.   : 39.20   Max.   :10.63  </span></span>
<span><span class="co">#&gt;     Latitude    </span></span>
<span><span class="co">#&gt;  Min.   :52.73  </span></span>
<span><span class="co">#&gt;  1st Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Median :52.73  </span></span>
<span><span class="co">#&gt;  Mean   :52.73  </span></span>
<span><span class="co">#&gt;  3rd Qu.:52.73  </span></span>
<span><span class="co">#&gt;  Max.   :52.73</span></span></code></pre></div>
<p>The combined data frame contains 12603 records and starts at
1990-01-01 and ends at 2024-09-30.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henning Kage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
